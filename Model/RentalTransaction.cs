using RentMe.DAL;
using System.Data;

namespace RentMe.Model;

/// <summary>
/// RentalTransaction model class
/// </summary>
public class RentalTransaction
{
    private RentalLineItem _rentalLineItems;
    private FurnitureDAL _furnitureDAL;

    /// <summary>
    /// Initializes a new instance of the <see cref="RentalTransaction"/> class.
    /// </summary>
    public RentalTransaction()
    {
        this._rentalLineItems = new RentalLineItem();
        this._furnitureDAL = new FurnitureDAL();
    }

    // Standard autogenerated getter/setters

    public int RentalID { get; set; }
    public DateTime DateRented { get; set; }
    public DateTime DateDue { get; set; }
    public int EmployeeID { get; set; }
    public int MemberID { get; set; }

    /// <summary>
    /// Gets the rental line items.
    /// </summary>
    /// <value>
    /// The rental line items.
    /// </value>
    public RentalLineItem RentalLineItems
    {
        get => this._rentalLineItems;
    }

    /// <summary>
    /// Adds the line item.
    /// </summary>
    /// <param name="lineItem">The line item.</param>
    public void AddLineItem(int furnitureID, int quantity)
    {
        Furniture furniture = this._furnitureDAL.GetFurnitureByID(furnitureID);

        ArgumentNullException.ThrowIfNull(furniture);

        DataRow workRow = _rentalLineItems!.GetDataTable().NewRow();
        workRow["RentalID"] = this.RentalID;
        workRow["FurnitureID"] = furnitureID;
        workRow["Name"] = furniture.Name;
        workRow["Description"] = furniture.Description;
        workRow["QuantityOwnedByStore"] = furniture.QuantityOwned;
        workRow["QuantityRentedByStore"] = furniture.QuantityRented;
        workRow["DailyRentalRate"] = furniture.DailyRentalRate;
        workRow["Category"] = furniture.Category;
        workRow["Style"] = furniture.Style;
        workRow["QuantityRentedByMember"] = quantity;
        workRow["QuantityReturnedByMember"] = 0;

        _rentalLineItems.GetDataTable().Rows.Add(workRow);
    }

    /// <summary>
    /// Removes the line item.
    /// </summary>
    /// <param name="furnitureID">The furniture identifier.</param>
    public void RemoveLineItem(int furnitureID)
    {
        var rows = _rentalLineItems!.GetDataTable().Select($"FurnitureID = {furnitureID}");

        foreach (var row in rows)
        {
            row.Delete();
        }

        _rentalLineItems!.GetDataTable().AcceptChanges();
    }

    /// <summary>
    /// Clears the line items.
    /// </summary>
    public void ClearLineItems()
    {
        this._rentalLineItems.GetDataTable().Clear();
    }
}